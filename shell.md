## shell

##### shell是一个命令行解释器，接收应用程序/内核命令，然后调用操作系统内核。

Shell 既是一种命令语言，又是一种程序设计语言。

```shell
#!/bin/bash
echo "Hello World !"
```

linux多用bash解释器

##### 流行的shell有ash、bash、ksh、csh、zsh等

![image-20241210171522774](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241210171522774.png)

### 一、变量

#### 1.环境变量

##### 作用域：整个操作系统

登录即启动bash(一号)，执行脚本即启动bash(二号)

$HOME、$PWD、$SHELL等

```
[root@local117 shell]# echo $SHELL
/bin/bash
```

##### 通过set查看系统所有环境变量

set -u后使用无设定变量会报错

set -x后使用命令会输出命令本身一次

##### 通过env只能看环境变量，无法看shell和本地变量

```
[root@local117 shell]# set
BASH=/bin/bash
BASHOPTS=checkwinsize:cmdhist:expand_aliases:extquote:force_fignore:histappend:hostcomplete:interactive_comments:login_shell:progcomp:promptvars:sourcepath
BASH_ALIASES=()
BASH_ARGC=()
BASH_ARGV=()
BASH_CMDS=()
BASH_LINENO=()
BASH_SOURCE=()
BASH_VERSINFO=([0]="4" [1]="2" [2]="46" [3]="2" [4]="release" [5]="x86_64-redhat-linux-gnu")
BASH_VERSION='4.2.46(2)-release'
COLUMNS=68
...
```

`printenv` 会显示所有的环境变量，输入 `printenv HOME` 则只显示 `HOME` 环境变量的值。

`set` 命令不仅会显示环境变量，还会显示所有的本地变量（包括由 shell 脚本或命令创建的变量）。

添加临时环境变量：（当前bash以及子bash可用，新启动的bash不能用）

```shell
export TEST_A=100
```

通过编辑  ~/ .bashrc长久修改环境变量

#### 2.普通变量（不要空格）

定义变量：变量名=变量

撤销变量：unset 变量值

静态变量：readonly 变量名=变量值  #不能撤销

#### 3.特殊变量

##### $n:

$1 $2 $3等n代表数字

$0代表脚本名，$*代表所有变量（看整体），$#传参个数，$@代表所有变量（区分看），$?返回上一条命令执行状态（0执行成功）

vim a.sh

```shell
#!\bin\bash
echo $1
echo $2
```

```
bash ./a.sh abc 100
abc
100
```

| 变量名 | 含义                                                         |
| ------ | ------------------------------------------------------------ |
| $n     | n代表数字(0-9)，0代表当前脚本名称，$1是传入的第一个参数9以上要用{}包裹例如{10} |
| $*     | 把所有参数看成一个整体                                       |
| $@     | 所有参数但区分对待                                           |
| $#     | 代表参数个数                                                 |
| $?     | 上一条命令的返回状态，0正确执行，非0错误                     |
| $$     | 当前进程的进程号                                             |
| $!     | 后台运行的最后一个进程的进程号(PID)                          |



### 二、规则

#### 1.符号规则

| 符号   | 作用                                                         |
| ------ | ------------------------------------------------------------ |
| ''和"" | 单引号原样输出，双引号会识别变量值和实现转义                 |
| \      | 让特殊符号失去特殊含义                                       |
| ``     | 内容是系统命令，优先执行                                     |
| $()    | 同上                                                         |
| ()     | 用于一串命令执行时，()中的命令会在子Shell中运行              |
| {}     | 用于一串命令执行时，{ }中的命令会在当前Shell中执行。也可以用于变量变形与替换。echo {1..5} |
| []     | 用于变量测试（条件判断）                                     |
| #      | 注释                                                         |
| $      | 变量引用，$name调用变量值                                    |

反引号：``命令替换，优先执行反引号内的内容

| 多命令执行符 | 格式           | 作用              |
| ------------ | -------------- | ----------------- |
| ;            | 命令1;命令2    | 按顺序执行命令    |
| &&           | 命令1&&命令2   | 命令1(?=0)则命令2 |
| \|\|         | 命令1\|\|命令2 | 命令1(?≠0)则命令2 |



#### 2.输入输出重定向

输入重定向

| 类型           | 语法             | 功能                                               |
| -------------- | ---------------- | -------------------------------------------------- |
| 标准输入       | 命令<文件1       | 命令把文件内容作为标准输入设备                     |
| 标识符限定输入 | 命令<<标识符     | 命令把标准输入中读入内容，直到遇到"标识符"为止     |
| 输入输出重定向 | 命令<文件1>文件2 | 命令把文件1的内容作为标准输入，把文件2作为标准输出 |

输出重定向

| 类型                         | 语法            | 功能                                    |
| ---------------------------- | --------------- | --------------------------------------- |
| 标准输出重定向               | 命令>文件1      | 命令输出结果覆盖掉文件1中的内容         |
| 标准输出重定向               | 命令>>文件1     | 命令输出结果追加到文件1中的内容后       |
| 标准错误输出重定向           | 错误命令>>文件1 | 把命令的错误信息输出到文件1中的内容后   |
| 标准错误输出重定向           | 错误命令>文件1  | 把命令的错误信息覆盖掉文件1中的内容     |
| 标准输出和标准错误输出重定向 | 命令&>文件1     | 正确输出、错误信息都覆盖到文件1的内容   |
| 标准输出和标准错误输出重定向 | 命令&>>文件1    | 正确输出、错误信息都追加到文件1的内容后 |

##### /dev/null文件：结果无底洞

#### 3.接受键盘输入

```
read [选项] [变量名]
 #基本读取
read value

#提示信息
read -p "请输入内容：" value

#限制输入字符数
read -n 5 num  

#超时不给输入，单位秒
read -t 5 var

#结束分隔符规定
read -d ':' var

#隐藏输入数据
read -s var
```

#### 4.算数运算

+-*/%=!=...其中在expr中，\*需要用''引起来

命令符号间需要空格：例如A=$(expr 3 + 5) #$()与``等价

赋值不能有空格

#### 5.关系运算符

| 运算符 | 单词                | 作用                                                  |
| ------ | ------------------- | ----------------------------------------------------- |
| -eq    | equal               | 检测两个数是否相等，相等返回 true。                   |
| -ne    | not equal           | 检测两个数是否相等，不相等返回 true。                 |
| -gt    | great than          | 检测左边的数是否大于右边的，如果是，则返回 true。     |
| -lt    | less than           | 检测左边的数是否小于右边的，如果是，则返回 true。     |
| -ge    | great than or equal | 检测左边的数是否大于等于右边的，如果是，则返回 true。 |
| -le    | less than or equal  | 检测左边的数是否小于等于右边的，如果是，则返回 true。 |

##### 示例：

[ $a -eq $b ]

##### 6.逻辑运算符

| 运算符 | 说明   | 示例                       |
| ------ | ------ | -------------------------- |
| !      | 非     | [ !false ]返回true         |
| -o     | or 或  | [ $a -lt $b -o $a -lt $c ] |
| -a     | and 与 | [ $a -lt $b -a $a -lt $c ] |

##### 7.文件判断符（重点）

| 操作符     | 说明                     | 举例                           |
| ---------- | ------------------------ | ------------------------------ |
| -b         | 块设备                   | [ -b $file ]是则反馈true       |
| -c         | 字符设备                 | [ -c $file ]是则反馈true       |
| -d         | 目录                     | [ -d $file ]是则反馈true       |
| -f         | 文件                     | [ -f $file ]是则反馈true       |
| -g         | 设置SGID位               | [ -g $file ]是则反馈true       |
| -k         | 设置粘着位（Sticky Bit） | [ -k $file ]是则反馈true       |
| -p         | 有名管道                 | [ -p $file ]是则反馈true       |
| -u         | 设置SUID位               | [ -u $file ]是则反馈true       |
| -r、-w、-x | 是否可读、可写、可执行   | [ -r -w -x $file ]是则反馈true |

| -s   | 大小大于0 | [ -s $file ]是则反馈true |
| ---- | --------- | ------------------------ |
| -e   | 是否存在  | [ -e $file ]是则反馈true |

##### 8.字符串运算符

| 运算符 | 说明                   | 举例                     |
| ------ | ---------------------- | ------------------------ |
| =      | 判断两个字符串是否相等 | [ $a = $b ] 是则返回true |
| !=     | 同上，返回结果相反     | [ $a != $b ]是则返回true |
| -z     | 长度是否为0            | [ -z $a ]是则为true      |
| -n     | 长度是否不为0          | [ -n $a ]是则为true      |
| str    | 是否为空               | [ $a ]是则为true         |

### 三、流程判断

if、双分支if、多分支if、多分支case、for、while、until

exit、break、continue

#### 1.if条件判断

if [ 条件判断式 ]

​	then

​		内容

fi

案例

```shell
if [ $var -ge 80 ]
	then
		echo "大于80"
fi
```

##### 双分支

if [ 条件判断式 ]

​	then

​		内容

​	else

​		内容

fi

##### 多分支

if [ 条件判断式 ]

​	then

​		内容

elif

​	then

​		内容

fi

#### 2.多分支case条件语法

case $变量名 in

​		"值1")

​		程序1

​		;;

​		"值2")

​		程序2

​		;;

​		*) 

​		如果变量的值都不是以上就执行此程序

​		;;

esac

#### 3.for循环

##### 语法1：

for 变量 in 值1 值2 值3...(也可以是一个文件)

​	do

​		执行程序

​	done

```shell
#!/bin/bash
touch ls.log #创建一个存储脚本文件名的文件
ls *.sh>ls.log #列出当前文件夹里的所有.sh结尾的文件，把名字导入ls.log
for i in `cat ls.log` #循环读取
        do
                mv $i ./1 #移动到1目录里
        done

```



##### 语法2：

for (( 初始值;循环控制条件;变量变化 ))

​	do

​		执行程序

​	done

#### 4.while循环

while [ 条件判断式 ]

​	do

​		程序

​	done

#### 5.until循环（与while相反）

until [ 条件判断式 ]

​	do

​		程序

​	done

##### 6.函数

function 函数名 () {

​	程序

}

#### 7.特殊流程控制语句

##### 1.exit [返回值]

在系统中exit会退出当前用户的登录状态

在Shell脚本中exit会结束当前程序，后续的程序就不再执行

2.break

3.coutinue
